# ğŸ¥ Multi-Tenant Medical Inventory Management System

## 1. Project Overview (Abstract)

This project is a **Multi-Tenant Medical Inventory Management System**, a full-stack web application built using **Node.js**, **Express.js**, and an **Oracle Database**.

The system is designed as a **Software as a Service (SaaS)** solution, allowing multiple independent pharmacies to sign up for their own private accounts.  
All data for each pharmacy (including their medicines, stock levels, and suppliers) is **100% isolated and secured** from all other accounts on the platform.

**Primary Function:**  
Helps pharmacy owners manage their inventory through features like adding stock (Purchases), issuing stock (Sales), receiving real-time dashboard alerts (Low Stock & Near Expiry), and generating reports.

---

## 2. ğŸ’» Technology Stack

| Layer | Technology / Tools |
|-------|--------------------|
| **Frontend** | EJS (Embedded JavaScript) â€“ Server-Side Rendered HTML |
| **UI Framework** | Bootstrap 5 (Responsive Design) |
| **Backend** | Node.js & Express.js (Server Logic, API) |
| **Database** | Oracle 11g Express Edition |
| **Database Driver** | node-oracledb (Configured in Thick Mode via `initOracleClient`) |
| **Core Packages** | `express-session` (Authentication), `bcrypt` (Password Hashing), `uuid` (Primary Keys), `connect-flash` (User Feedback) |

---

## 3. âœ¨ Key Features

### ğŸ” Multi-Tenant Authentication
Each pharmacy can create a separate account. Data is fully isolated.

### ğŸ”’ Secure Auth Flow
- Passwords are hashed using **bcrypt** on signup.
- Login verification uses `bcrypt.compare`.

### ğŸ§‘â€ğŸ’¼ Role-Based Access
Session-based route protection implemented via `isLoggedIn` middleware.

### ğŸ§± Full CRUD Functionality
| Operation | Features |
|------------|-----------|
| **Create** | Add new Medicine Types, Suppliers, Stock Batches, and Issue records. |
| **Read** | View all Stock, Medicines, Suppliers, and Reports. |
| **Update** | Edit details for existing Medicines and Suppliers. |
| **Delete** | Remove Medicines and Suppliers from the system. |

### ğŸ“Š Real-time Dashboard
Displays instant alerts for **Low Stock** and **Near Expiry** items on login.

### ğŸ’¬ Feedback System
Uses `connect-flash` for persistent success/error messages after actions (e.g., *"Stock added successfully!"*).

### ğŸ§© Database-Driven Logic
Core logic like stock updates handled by **Database Triggers**, not JavaScript.

---

## 4. ğŸ§  Core DBMS Concepts Implemented

### A. Multi-Tenant Data Architecture (Data Isolation)
- A **master `Pharmacies` table** stores all pharmacy accounts.
- All other tables (`Users`, `Medicines`, `Stock`, `Suppliers`, `Issues`) include a `pharmacy_id` **Foreign Key**.
- Every query includes:  
  ```sql
  WHERE pharmacy_id = :b_pid
  where `:b_pid` is fetched from the user's `req.session.user` object after they log in.  
This guarantees that **'MedPlus' can never see data belonging to 'Apollo'**.

---

### B. ğŸ§± Entity-Relationship (ER) Model

A normalized schema was designed using 6 primary tables:

| Table | Columns |
|--------|----------|
| **Pharmacies** | `pharmacy_id [PK]`, `pharmacy_name` |
| **Users** | `user_id [PK]`, `pharmacy_id [FK]`, `username [Unique]`, `password_hash` |
| **Medicines** | `medicine_id [PK]`, `pharmacy_id [FK]`, `name`, `description`, `image_filename` |
| **Suppliers** | `supplier_id [PK]`, `pharmacy_id [FK]`, `name`, `contact_person` |
| **Stock** | `batch_id [PK]`, `pharmacy_id [FK]`, `medicine_id [FK]`, `supplier_id [FK]`, `quantity_remaining`, `expiry_date` |
| **Issues** | `issue_id [PK]`, `pharmacy_id [FK]`, `batch_id [FK]`, `quantity_issued` |

ğŸ”‘ **Primary Keys**  
Instead of using standard auto-incrementing sequences, this project uses `VARCHAR2(50)` Primary Keys generated by the Node.js `uuid` package.

---

### C. âš™ï¸ Database Triggers (Business Logic)

The application's core logic is enforced at the **database level** for maximum data integrity.

**Trigger Name:** `UPDATE_STOCK_ON_ISSUE`  
**Event:** `BEFORE INSERT ON Issues`  
**Purpose:** Fires automatically whenever a new issue record is created.

**Logic Flow:**

1. Check the `quantity_remaining` in the `Stock` table for the corresponding `batch_id`.
2. If `quantity_issued` is greater than available stock â†’  
   Raise error:
   ```sql
   RAISE_APPLICATION_ERROR(-20001, 'Not enough stock');
